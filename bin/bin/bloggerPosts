#!/bin/python3
import requests
import sys

if len(sys.argv) != 2:
    print("You need to provide a URL for a blogger website")
    exit(0)

key = "AIzaSyCQp6n50P0rmd4uWZ78U0bDg4J3tvhedXg"

r = requests.get(f"https://www.googleapis.com/blogger/v3/blogs/byurl?key={key}&url={sys.argv[1]}")


if r.status_code != 200:
    print(f"Error {r.status_code}")
print(f"Loading {r.json()['posts']['totalItems']} posts...")
requrl = r.json()['posts']['selfLink']

ptoken = ""
n = 1
while True:
    r = requests.get(f"{requrl}?key={key}&fetchBodies=false{f'&pageToken={ptoken}' if ptoken!='' else ''}")
    for post in r.json()["items"]:
        print(f"{n}. {post['title']}: {post['published']} {post['url']}")
        n+=1
    try:
        ptoken = r.json()["nextPageToken"]
    except:
        break
